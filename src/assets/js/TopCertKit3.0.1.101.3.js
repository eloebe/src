function TCA(){return!1}TCA.config=function(a){CPlugin.getInstance(a)};TCA.SM1="SM1";TCA.SM4="SM4";TCA.DES="DES";TCA.DES3="3DES";TCA.AES="AES";TCA.RC4="RC4";TCA.SM2="SM2";TCA.RSA1024="RSA1024";TCA.RSA2048="RSA2048";TCA.SHA256="SHA256";TCA.SHA1="SHA1";TCA.SM3="SM3";TCA.digitalSignature=128;TCA.nonRepudiation=64;TCA.keyEncipherment=32;TCA.dataEncipherment=16;TCA.keyAgreement=8;TCA.keyCertSign=4;TCA.cRLSign=2;TCA.encipherOnly=1;TCA.decipherOnly=32768;TCA.contentCommitment=64;TCA.serverAuth="1.3.6.1.5.5.7.3.1";
TCA.clientAuth="1.3.6.1.5.5.7.3.2";TCA.codeSigning="1.3.6.1.5.5.7.3.3";TCA.emailProtection="1.3.6.1.5.5.7.3.4";TCA.ipsecEndSystem="1.3.6.1.5.5.7.3.5";TCA.ipsecTunnel="1.3.6.1.5.5.7.3.6";TCA.ipsecUser="1.3.6.1.5.5.7.3.7";TCA.timeStamping="1.3.6.1.5.5.7.3.8";TCA.OCSPSigning="1.3.6.1.5.5.7.3.9";TCA.dvcs="1.3.6.1.5.5.7.3.10";TCA.sbgpCertAAServerAuth="1.3.6.1.5.5.7.3.11";TCA.scvpResponder="1.3.6.1.5.5.7.3.12";TCA.eapOverPPP="1.3.6.1.5.5.7.3.13";TCA.eapOverLAN="1.3.6.1.5.5.7.3.14";TCA.scvpServer="1.3.6.1.5.5.7.3.15";
TCA.scvpClient="1.3.6.1.5.5.7.3.16";TCA.ipsecIKE="1.3.6.1.5.5.7.3.17";TCA.capwapAC="1.3.6.1.5.5.7.3.18";TCA.capwapWTP="1.3.6.1.5.5.7.3.19";TCA.smartcardlogon="1.3.6.1.4.1.311.20.2.2";TCA.EX={};TCA.EX.szOID_RSA_MD5RSA="1.2.840.113549.1.1.4";TCA.EX.szOID_RSA_SHA1RSA="1.2.840.113549.1.1.5";TCA.EX.szOID_SM2_SM3SM2="1.2.156.10197.1.501";TCA.EX.INPUT_BASE64=1;TCA.EX.INPUT_HEX=2;TCA.EX.OUTPUT_BASE64=4;TCA.EX.OUTPUT_HEX=8;TCA.EX.INNER_CONTENT=16;TCA.EX.PLAINTEXT_UTF8=32;TCA.EX.MIN_CERTSTORE=64;
TCA.EX.HTML_SHOW=128;TCA.EX.MSG_BASE64=4;TCA.EX.MSG_HEX=8;TCA.EX.MSG_IMAGE=256;TCA.EX.ONLY_SIGNATURE=512;TCA.EX.PARAM_FILENAME=4096;TCA.EX.PARAM_STRING=8192;TCA.EX._pta_OverlapPeriod=30;TCA.EX.FUNCOPT_NOALERT=2147483648;TCA.EX.AlgID=1048576;
TCA.EX.exkeyusagemap={"1.3.6.1.5.5.7.3.1":"serverAuth","1.3.6.1.5.5.7.3.2":"clientAuth","1.3.6.1.5.5.7.3.3":"codeSigning","1.3.6.1.5.5.7.3.4":"emailProtection","1.3.6.1.5.5.7.3.5":"ipsecEndSystem","1.3.6.1.5.5.7.3.6":"ipsecTunnel","1.3.6.1.5.5.7.3.7":"ipsecUser","1.3.6.1.5.5.7.3.8":"timeStamping","1.3.6.1.5.5.7.3.9":"OCSPSigning","1.3.6.1.5.5.7.3.10":"dvcs","1.3.6.1.5.5.7.3.11":"sbgpCertAAServerAuth","1.3.6.1.5.5.7.3.12":"scvpResponder","1.3.6.1.5.5.7.3.13":"eapOverPPP","1.3.6.1.5.5.7.3.14":"eapOverLAN",
"1.3.6.1.5.5.7.3.15":"scvpServer","1.3.6.1.5.5.7.3.16":"scvpClient","1.3.6.1.5.5.7.3.17":"ipsecIKE","1.3.6.1.5.5.7.3.18":"capwapAC","1.3.6.1.5.5.7.3.19":"capwapWTP","1.3.6.1.4.1.311.20.2.2":"smartcardlogon"};TCA.EX.URLDecode=function(a){return unescape(String(a).replace(/\+/g," "))};
function CertStore(a){function c(d,b,a,c,f,l){try{this._xenroll=CPlugin.getInstance().getXEnroll();this._xenroll.Reset();this._xenroll.ProviderName=c;this._xenroll.ProviderType=f;c=0;var m=f="";b==TCA.RSA1024?(c=67108864,f=TCA.EX.szOID_RSA_SHA1RSA,m="SHA1"):b==TCA.RSA2048?(c=134217728,f=TCA.EX.szOID_RSA_SHA1RSA,m="SHA1"):(c=16777216,f=TCA.EX.szOID_SM2_SM3SM2,m="SM3");this._xenroll.KeySpec=1;this._xenroll.DeleteRequestCert=!1;this._xenroll.SignAlgOId=f;this._xenroll.HashAlgorithm=m;"string"==typeof l&&
""!=l&&(this._xenroll.UseExistingKeySet=!0,this._xenroll.ContainerName=l);this._xenroll.GenKeyFlags=c|a;var q=this._xenroll.generatePKCS10(d,"1.3.6.1.5.5.7.3.2");return new Csr(q.replace(/\r*\n/g,""))}catch(n){throw d=new TCACErr,d.addError(n.number,n.description),d.addError(268435459,"\u751f\u6210CSR\u65f6\u51fa\u73b0\u5f02\u5e38"),d;}}this._pta=CPlugin.getInstance().getPTA();this._xenroll=CPlugin.getInstance().getXEnroll();CPlugin.getInstance().getConfig("useAlias")&&(a=CPlugin.getInstance().alias2Full(a));
this._cspname=a;for(var b=function(){var d=CPlugin.getInstance().getXEnroll(),b=[];d.Reset();for(var a=0;1>=a;a++){d.ProviderType=a;for(var c=0;100>c;c++){try{var f=d.enumProviders(c,0)}catch(l){break}if(null==f)break;if(0>=f.length)break;b.push({n:f,t:a})}}return b}(),d=0;d<b.length;d++)if(b[d].n==a){this._csptype=b[d].t;break}if(void 0===this._csptype)throw TCACErr.newError(268435457,"\u6ca1\u6709\u627e\u5230\u5bf9\u5e94\u7684\u7c7b\u578b");this.genCsr=function(d,b){if(1==arguments.length){if("string"==
typeof d)return c("CN=topca",d,1,this._cspname,this._csptype);if(d instanceof Certificate){var a=CPlugin.getInstance().convertCert(d);if(null==a)throw TCACErr.newError(268435469,"\u8f93\u5165\u683c\u5f0f\u4e0d\u6b63\u786e");var h=d.publicKeyAlg(),f=d.publicKeySize();return c("CN=topca","RSA"==h&&1024==f?TCA.RSA1024:"RSA"==h&&2048==f?TCA.RSA2048:TCA.SM2,1,this._cspname,this._csptype,a.KeyContainer)}return null}if(2==arguments.length)return c(b,d,1,this._cspname,this._csptype);if(0==arguments.length)return c("CN=topca",
TCA.SM2,1,this._cspname,this._csptype);throw TCACErr.newError(268435466,"\u9519\u8bef\u7684\u8f93\u5165");};this.listCerts=function(){for(var d=CertStore.listAllCerts(),b=[],a=0;a<d.size();a++)d.get(a)._cert.CSP==this._cspname&&b.push(CertStore.get(a)._cert.GetEncodedCert(2));return new CertSet(b)};this.getSupportedKeyAlgs=function(){try{this._xenroll.ProviderName=this._cspname;this._xenroll.ProviderType=this._csptype;for(var d=[],b=0;40>b;b++){var a=this._xenroll.enumProviderAlg(b);0!=a&&(26129==
a?d.push(TCA.AES):26144==a?d.push(TCA.SM4):26143==a?d.push(TCA.SM1):26115==a&&d.push(TCA.DES3))}return d}catch(c){throw d=new TCACErr,d.addError(c.number,c.description).addError(268435460,"\u83b7\u53d6\u7b97\u6cd5\u65f6\u51fa\u73b0\u5f02\u5e38"),d;}};this.importPFX=function(d,b){var a=CPlugin.getInstance().getPTA();if(0>this._cspname.indexOf("Microsoft"))throw TCACErr.newError(268435467,"\u65e0\u6cd5\u5411\u6307\u5b9a\u7684CertStore\u4e2d\u5bfc\u5165PFX\u8bc1\u4e66");try{var c=a.ImportPKCS12(d,b,
8).GetEncodedCert(2);return new Certificate(c)}catch(f){throw a=new TCACErr,a.addError(f.number,f.description).addError(268435468,"\u5bfc\u5165PFX\u8bc1\u4e66\u5931\u8d25"),a;}}}
CertStore.listAllCerts=function(){try{var a=CPlugin.getInstance().getLicInfo("Issuer"),c=new RegExp(a);CPlugin.getInstance().getPTA().Filter.Clear();for(var b=CPlugin.getInstance().getPTA().MyCertificates,a=[],d=CPlugin.getInstance().getConfig("otherio"),k=CPlugin.getInstance().getConfig("licenseio"),e=1;e<=b.Count;e++){var g=b.Item(e),h=g.Issuer;c.test(h)&&a.push(b.Item(e).GetEncodedCert(2))}if(d){var f=CPlugin.getInstance().getPTA().OtherCertificates;if(null==f)return null;if(k)for(e=1;e<=f.Count;e++)g=
f.Item(e),h=g.Issuer,c.test(h)&&a.push(f.Item(e).GetEncodedCert(2));else for(e=1;e<=f.Count;e++)a.push(f.Item(e).GetEncodedCert(2))}return new CertSet(a)}catch(l){throw c=new TCACErr,c.addError(l.number,l.description).addError(268435461,"\u8bfb\u53d6\u5168\u90e8\u8bc1\u4e66\u65f6\u51fa\u73b0\u5f02\u5e38"),c;}};
CertStore.listStore=function(a){var c=CPlugin.getInstance(),b=c.getConfig("whiteList"),d=c.getXEnroll(),k=[],e=c.getConfig("useAlias");d.Reset();for(var g=0;1>=g;g++){d.ProviderType=g;for(var h=0;100>h;h++){try{var f=d.enumProviders(h,0)}catch(l){break}if(null==f)break;if(0>=f.length)break;if(1==a)for(var m=0;m<b.length;m++){if(f==b[m]){1==e?k.push(c.full2Alias(f)):k.push(f);break}}else m=1==e?c.full2Alias(f):f,k.push(m)}}return k};
CertStore.byName=function(a){CPlugin.getInstance().getConfig("useAlias");for(var c=CertStore.listStore(!1),b=0;b<c.length;b++)if(-1!=c[b].search(a))return new CertStore(c[b]);return null};CertStore.byCert=function(a){a=CPlugin.getInstance().convertCert(a);if(null==a)throw TCACErr.newError(268435462,"\u8bc1\u4e66\u8f6c\u6362\u51fa\u9519");a=a.CSP;a=CPlugin.getInstance().full2Alias(a);for(var c=CertStore.listStore(!1),b=0;b<c.length;b++)if(-1!=c[b].search(a))return new CertStore(a);return null};
CertStore.installCert=function(a,c,b){var d=CPlugin.getInstance().getXEnroll();if(1==arguments.length)try{return d.Reset(),d.DeleteRequestCert=!1,d.WriteCertToCSP=!0,d.acceptPKCS7(a),!0}catch(k){throw TCACErr.newError(k.number,k.description).addError(268435463,"\u5b89\u88c5\u8bc1\u4e66\u65f6\u51fa\u73b0\u5f02\u5e38");}else if(3==arguments.length){for(var e=b.split("&"),g={},h=0;h<e.length;h++){var f=e[h].split("=");g[f[0]]=TCA.EX.URLDecode(f[1])}try{d.Reset();d.containerName="";d.KeySpec=1;d.DeleteRequestCert=
!1;d.WriteCertToCSP=!0;this._pta=CPlugin.getInstance().getPTA();this._cert=this._pta.ParseCertFromB64(a);var l=this._cert.SerialNumber,m=this._pta.Filter;m.Clear();m.SerialNumber=l;var q=this._pta.MyCertificates;if(0==q.Count)throw TCACErr.newError(268435458,"\u6ca1\u6709\u627e\u5230\u6307\u5b9a\u7684\u8bc1\u4e66");var n=q.Item(1).CSP,p=(new Certificate(a)).publicKeyAlg();0<=n.indexOf("Microsoft")||0<=n.indexOf("iTrus")||"RSA"==p?d.acceptSeal(a,g.userSeal,c,g.encPrivateKeyUser,g.userCipher,g.userIV):
d.installEncCert(a,g.userSeal,c,g.encPrivateKeyUser,g.userCipher,g.userIV);return!0}catch(r){throw TCACErr.newError(r.number,r.description).addError(268435464,"\u5b89\u88c5\u8bc1\u4e66\u65f6\u51fa\u73b0\u5f02\u5e38");}}else throw TCACErr.newError(268435465,"\u9519\u8bef\u7684\u8f93\u5165");};
function Certificate(a){function c(b,d,a){var c=null,g=null;a?(c=TCA.EX.PARAM_STRING|TCA.EX.INPUT_HEX,g=TCA.EX.PARAM_STRING|TCA.EX.OUTPUT_BASE64):(c=TCA.EX.PARAM_STRING|TCA.EX.INPUT_BASE64,g=TCA.EX.PARAM_STRING|TCA.EX.OUTPUT_HEX);var h;try{h=a?b.Encrypt(d,c,"",g):b.Decrypt(d,c,"",g)}catch(f){if(b=f.number>>>0,a)switch(b.toString(16)){case "80081001":throw TCACErr.newError(f.number,f.description).addError(2148012033,"\u8bc1\u4e66\u4e0a\u4e0b\u6587\u65e0\u6548");case "80082001":throw TCACErr.newError(f.number,
f.description).addError(2148016129,"\u4ece\u6587\u4ef6\u8bfb\u53d6\u6587\u4ef6\u5931\u8d25");case "80082002":throw TCACErr.newError(f.number,f.description).addError(2148016130,"\u53c2\u6570\u9519\u8bef");case "80083001":throw TCACErr.newError(f.number,f.description).addError(2148020225,"SM2\u52a0\u5bc6\u5931\u8d25");case "80083002":throw TCACErr.newError(f.number,f.description).addError(2148020226,"RSA\u52a0\u5bc6\u5931\u8d25");case "80084001":throw TCACErr.newError(f.number,f.description).addError(2148024321,
"\u6587\u4ef6\u5199\u5165\u5931\u8d25");default:throw alert("\u672a\u77e5\u9519\u8bef"),TCACErr.newError(f.number,f.description).addError(2148007936,"\u672a\u77e5\u9519\u8bef");}else switch(b.toString(16)){case "80081001":throw TCACErr.newError(f.number,f.description).addError(2148012033,"\u8bc1\u4e66\u4e0a\u4e0b\u6587\u65e0\u6548");case "80082001":throw TCACErr.newError(f.number,f.description).addError(2148016129,"\u4ece\u6587\u4ef6\u8bfb\u53d6\u6587\u4ef6\u5931\u8d25");case "80082002":throw TCACErr.newError(f.number,
f.description).addError(2148016130,"\u53c2\u6570\u9519\u8bef");case "80083001":throw TCACErr.newError(f.number,f.description).addError(2148020225,"\u83b7\u53d6\u79c1\u94a5\u4fe1\u606f\u5931\u8d25");case "80083002":throw TCACErr.newError(f.number,f.description).addError(2148020226,"\u83b7\u53d6\u79c1\u94a5\u4fe1\u606f\u5931\u8d25");case "80083003":throw TCACErr.newError(f.number,f.description).addError(2148020227,"\u8bfb\u53d6\u79c1\u94a5\u5931\u8d25");case "80083004":throw TCACErr.newError(f.number,
f.description).addError(2148020228,"\u8bfb\u53d6\u79c1\u94a5\u5931\u8d25");case "80083005":throw TCACErr.newError(f.number,f.description).addError(2148020229,"\u89e3\u5bc6\u6570\u636e\u5931\u8d25");case "80084001":throw TCACErr.newError(f.number,f.description).addError(2148024321,"\u6587\u4ef6\u5199\u5165\u5931\u8d25");default:throw TCACErr.newError(f.number,f.description).addError(2148007936,"\u672a\u77e5\u9519\u8bef");}}return h}this._pta=CPlugin.getInstance().getPTA();this._b64str=a.replace(/(^\s+)|(\s+$)/g,
"").replace(/-----BEGIN CERTIFICATE REQUEST-----/,"").replace(/-----END  CERTIFICATE REQUEST-----/,"");this._cert=this._pta.ParseCertFromB64(this._b64str);this.signLogondata=function(b){if(16<b.length)return null;try{return this._pta.Filter.SerialNumber=this._cert.serialNumber,this._pta.MyCertificates.Item(1).SignLogonData("LOGONDATA:"+b,TCA.EX.OUTPUT_BASE64|TCA.EX.PLAINTEXT_UTF8)}catch(d){throw TCACErr.newError(d.number,d.description).addError(536870913,"\u7b7e\u540d\u65f6\u51fa\u73b0\u5f02\u5e38");
}};this.serialNumber=function(){return this._cert.SerialNumber.toUpperCase()};this.issuer=function(){return this._cert.Issuer};this.notBefore=function(){return eval(this._cert.ValidFrom)+""};this.notAfter=function(){return eval(this._cert.ValidTo)+""};this.subject=function(){return this._cert.Subject};this.signAlg=function(){var b=new ASN1.decode(Base64.unarmor(this._b64str));if(null==b||""==b)return"UnknownSignAlg";switch(b.sub[0].sub[2].sub[0].content()){case TCA.EX.szOID_SM2_SM3SM2:return"SM3WithSM2";
case TCA.EX.szOID_RSA_SHA1RSA:case "1.3.14.3.2.29":return"SHA1WithRSA";case TCA.EX.szOID_RSA_MD5RSA:return"MD5WitrhRSA";default:return"UnknownSignAlg"}};this.publicKeyAlg=function(){var b=new ASN1.decode(Base64.unarmor(this._b64str)),d="";if(null==b||""==b)return"UnknownSignAlg";switch(b.sub[0].sub[2].sub[0].content()){case TCA.EX.szOID_SM2_SM3SM2:d="SM3WithSM2";break;case TCA.EX.szOID_RSA_SHA1RSA:case "1.3.14.3.2.29":d="SHA1WithRSA";break;case TCA.EX.szOID_RSA_MD5RSA:d="MD5WitrhRSA";break;default:d=
"UnknownSignAlg"}switch(d){case "SM3WithSM2":return"SM2";case "SHA1WithRSA":case "MD5WitrhRSA":return"RSA";default:return"UnknownAlg"}};this.publicKeySize=function(){var b=new ASN1.decode(Base64.unarmor(this._b64str)),d="";if(null==b||""==b)return"UnknownSignAlg";switch(b.sub[0].sub[2].sub[0].content()){case TCA.EX.szOID_SM2_SM3SM2:d="SM3WithSM2";break;case TCA.EX.szOID_RSA_SHA1RSA:case "1.3.14.3.2.29":d="SHA1WithRSA";break;case TCA.EX.szOID_RSA_MD5RSA:d="MD5WitrhRSA";break;default:d="UnknownSignAlg"}switch(d){case "SM3WithSM2":return 256;
case "SHA1WithRSA":case "MD5WitrhRSA":switch(b=new ASN1.decode(Base64.unarmor(this._b64str)),b.sub[0].sub[6].sub[1].sub[0].sub[0].length){case 128:case 129:return 1024;default:return 2048}default:return-1}};this.show=function(){this._cert.View()};this.keyUsage=function(){var b=this._cert.KeyUsage,d=[];if(0==b)return d;b&TCA.digitalSignature&&d.push("digitalSignature");b&TCA.nonRepudiation&&d.push("nonRepudiation");b&TCA.keyEncipherment&&d.push("keyEncipherment");b&TCA.dataEncipherment&&d.push("dataEncipherment");
b&TCA.keyAgreement&&d.push("keyAgreement");b&TCA.keyCertSign&&d.push("keyCertSign");b&TCA.cRLSign&&d.push("cRLSign");b&TCA.encipherOnly&&d.push("encipherOnly");b&TCA.decipherOnly&&d.push("decipherOnly");b&TCA.contentCommitment&&d.push("contentCommitment");return d};this.extededKeyUsage=function(){var b=this._cert.GetX509ExtByOID("2.5.29.37");if(""==b||null==b)return null;for(var b=new ASN1.decode(Base64.unarmor(b)),d=[],a=0;a<b.sub.length;a++)d.push(TCA.EX.exkeyusagemap[b.sub[a].content()]);return d};
this.crlUrl=function(){var b=this._cert.GetX509ExtByOID("2.5.29.31");return""==b||null==b?null:(new ASN1.decode(Base64.unarmor(b))).sub[0].sub[0].sub[0].sub[0].content()};this.signMessage=function(b,d){try{var a=CPlugin.getInstance().getConfig("alertOnSignMessage");this._pta.Filter.SerialNumber=this.serialNumber();var c=this._pta.MyCertificates;if(null==c)throw TCACErr.newError(536870917,"\u627e\u4e0d\u5230\u7b7e\u540d\u8bc1\u4e66");var g=c.Item(1),c=0,h=null;if(1==arguments.length)c=TCA.EX.INNER_CONTENT;
else if(2==arguments.length)c=d?TCA.EX.INNER_CONTENT:0;else throw TCACErr.newError(536870916,"\u9519\u8bef\u7684\u8f93\u5165\u53c2\u6570");return h=a?g.SignMessage(b,TCA.EX.OUTPUT_BASE64|c|TCA.EX.PLAINTEXT_UTF8):g.SignMessage(b,TCA.EX.OUTPUT_BASE64|c|TCA.EX.FUNCOPT_NOALERT|TCA.EX.PLAINTEXT_UTF8)}catch(f){throw TCACErr.newError(f.number,f.description).addError(536870914,"\u7b7e\u540d\u65f6\u51fa\u73b0\u5f02\u5e38");}};this.signFileP7=function(b,d){try{if(2==arguments.length){var a=this.publicKeyAlg();
if("SM2"===a&&d!==TCA.SM3||"RSA"===a&&d!==TCA.SHA1){if("RSA"===a&&d===TCA.SHA256)throw TCACErr.newError(536870948,"\u5f53\u524d\u4e0d\u652f\u6301SHA256\u7b97\u6cd5");throw TCACErr.newError(536870949,"\u54c8\u5e0c\u7b97\u6cd5\u8f93\u5165\u9519\u8bef");}}var c=CPlugin.getInstance().convertCert(this._cert);if(null==c)throw TCACErr.newError(536870936,"\u627e\u4e0d\u5230\u7b7e\u540d\u8bc1\u4e66");var g=TCA.EX.OUTPUT_BASE64|TCA.EX.PLAINTEXT_UTF8,g=CPlugin.getInstance().getConfig("alertOnSignMessage")?g:
g|TCA.EX.FUNCOPT_NOALERT;return c.SignFile(b,g)}catch(h){throw TCACErr.newError(h.number,h.description).addError(536870937,"\u7b7e\u540d\u6587\u4ef6\u65f6\u51fa\u73b0\u5f02\u5e38");}};this.signFileRaw=function(b,d){try{if(2==arguments.length){var a=this.publicKeyAlg();if("SM2"===a&&d!==TCA.SM3||"RSA"===a&&d!==TCA.SHA1){if("RSA"===a&&d===TCA.SHA256)throw TCACErr.newError(536870948,"\u5f53\u524d\u4e0d\u652f\u6301SHA256\u7b97\u6cd5");throw TCACErr.newError(536870949,"\u54c8\u5e0c\u7b97\u6cd5\u8f93\u5165\u9519\u8bef");
}}var c=CPlugin.getInstance().convertCert(this._cert);if(null==c)throw TCACErr.newError(536870936,"\u627e\u4e0d\u5230\u7b7e\u540d\u8bc1\u4e66");var g=TCA.EX.OUTPUT_BASE64|TCA.EX.ONLY_SIGNATURE|TCA.EX.INNER_CONTENT|TCA.EX.PARAM_FILENAME,g=CPlugin.getInstance().getConfig("alertOnSignMessage")?g:g|TCA.EX.FUNCOPT_NOALERT;return c.SignFile(b,g)}catch(h){throw TCACErr.newError(h.number,h.description).addError(536870937,"\u7b7e\u540d\u6587\u4ef6\u65f6\u51fa\u73b0\u5f02\u5e38");}};this.verifyFileRaw=function(b,
d){try{var a=CPlugin.getInstance().convertCert(this._cert);if(null==a)throw TCACErr.newError(536870938,"\u627e\u4e0d\u5230\u9a8c\u7b7e\u8bc1\u4e66");return a.VerifySignature(b,TCA.EX.PARAM_STRING|TCA.EX.INPUT_BASE64,d,TCA.EX.PARAM_FILENAME)}catch(c){throw TCACErr.newError(c.number,c.description).addError(536870939,"\u9a8c\u7b7e\u65f6\u51fa\u73b0\u5f02\u5e38");}};this.encryptMessage=function(b){try{var d=this._pta.GetEmptyCertificates();d.Add(this._cert);return d.EncryptMessage(b,TCA.EX.OUTPUT_BASE64|
TCA.EX.PLAINTEXT_UTF8)}catch(a){throw TCACErr.newError(a.number,a.description).addError(536870915,"\u52a0\u5bc6\u6d88\u606f\u65f6\u51fa\u73b0\u5f02\u5e38");}};this.Delete=function(){try{return this._cert.Remove(),!0}catch(a){return!1}};this.Encrypt=function(a){if(""==a)throw TCACErr.newError(536870918,"\u9519\u8bef\u7684\u8f93\u5165\u53c2\u6570");return c(this._cert,a,!0)};this.Decrypt=function(a){var d=CPlugin.getInstance().convertCert(this);return c(d,a,!1)}}
function Csr(a){this._data=Base64.unarmor(a);this._asn1=new ASN1.decode(this._data);this._subject="";this._b64str=a;a=this._asn1.sub[0].sub[1];for(var c={"2.5.4.3":"CN","2.5.4.11":"OU","2.5.4.10":"O","2.5.4.6":"C"},b=0;b<a.sub.length;b++){var d=a.sub[b].sub[0].sub[0].content(),k=a.sub[b].sub[0].sub[1].content();this._subject+=c[d]+"="+k+", "}this._subject=this._subject.substr(0,this._subject.length-2);this.subject=function(){return this._subject};this.toBase64=function(){return this._b64str};this.toPEM=
function(){for(var d="",a=this._b64str.length/64,b=0;b<a;b++)d+=this._b64str.substr(64*b,64)+"\n";0!=this._b64str.length%64&&(d+=this._b64str.substr(64*a,this._b64str.length-64*a));return"-----BEGIN CERTIFICATE REQUEST-----\n"+d+"\n-----END  CERTIFICATE REQUEST-----"}}
function Pkcs7(a){if(""==a||null==a)throw TCACErr.newError(805306378,"\u9519\u8bef\u7684\u8f93\u5165\u6570\u636e");this._pta=CPlugin.getInstance().getPTA();this._b64str=a;this._data="";this._statu=this._asn1=null;if("string"==typeof a)this._b64str=this._b64str.replace(/(^\s+)|(\s+$)/g,"").replace(/-----BEGIN CERTIFICATE-----\n/,"").replace(/\n-----END CERTIFICATE-----/,""),this._data=Base64.unarmor(this._b64str),this._asn1=new ASN1.decode(this._data),a=this._asn1.sub[0].content(),"1.2.840.113549.1.7.2"==
a?this._statu=2:"1.2.840.113549.1.7.3"==a&&(this._statu=1);else throw TCACErr.newError(805306369,"\u9519\u8bef\u7684\u8f93\u5165\u6570\u636e");this.contentMessage=function(){if(1==this._statu)throw TCACErr.newError(805306374,"\u9519\u8bef\u7684P7\u7c7b\u578b");try{return this._pta.GetContentFromSignStr(this._b64str,TCA.EX.INPUT_BASE64)}catch(a){throw TCACErr.newError(a.number,a.description).addError(805306375,"\u83b7\u53d6\u7b7e\u540d\u539f\u6587\u65f6\u51fa\u73b0\u9519\u8bef");}};this.verify=function(a){if(1==
this._statu)throw TCACErr.newError(805306372,"\u9519\u8bef\u7684P7\u7c7b\u578b");try{var b=this._pta.VerifySignature(void 0===a?"":a,this._b64str,TCA.EX.INPUT_BASE64|(void 0===a?TCA.EX.INNER_CONTENT:0)|TCA.EX.PLAINTEXT_UTF8);if(null==b)throw TCACErr.newError(805306376,"\u9a8c\u7b7e\u65b9\u6cd5\u5185\u90e8\u9519\u8bef");return new Certificate(b.GetEncodedCert(2))}catch(d){throw TCACErr.newError(d.number,d.description).addError(805306373,"\u9a8c\u8bc1\u7b7e\u540d\u65f6\u51fa\u73b0\u9519\u8bef");}};
this.decryptMessage=function(){if(2==this._statu)throw TCACErr.newError(805306371,"\u9519\u8bef\u7684P7\u7c7b\u578b");try{var a=this._pta.DecryptMessage(this._b64str,TCA.EX.INPUT_BASE64|TCA.EX.PLAINTEXT_UTF8);if(null==a||""==a)throw TCACErr.newError(805306377,"\u89e3\u5bc6\u65b9\u6cd5\u5185\u90e8\u9519\u8bef");return a}catch(b){throw TCACErr.newError(b.number,b.description).addError(805306370,"\u89e3\u5bc6\u65f6\u51fa\u73b0\u9519\u8bef");}};this.verifyFileP7=function(a){try{return this._pta.VerifySignatureEx(a,
TCA.EX.PARAM_FILENAME,this._b64str,TCA.EX.PARAM_STRING|TCA.EX.INPUT_BASE64,2)}catch(b){throw TCACErr.newError(b.number,b.description).addError(536870935,"\u9a8c\u7b7e\u6587\u4ef6\u65f6\u51fa\u73b0\u5f02\u5e38");}}}
function CertSet(a){this._pta=CPlugin.getInstance().getPTA();this._certs=this._pta.GetEmptyCertificates();var c=CPlugin.getInstance().getLicInfo("Issuer"),b=new RegExp(c);if(a instanceof Array){if(0!=a.length)if(c=a[0],c instanceof Certificate)for(c=0;c<a.length;c++)this._certs.Add(a[0]._cert);else if("string"==typeof c)for(c=0;c<a.length;c++)this._certs.Add(this._pta.ParseCertFromB64(a[c]));else throw TCACErr.newError(1073741825,"\u9519\u8bef\u7684\u8f93\u5165\u6570\u636e");}else if("string"==typeof a)this._certs.Add(this._pta.ParseCertFromB64(a));
else if(a instanceof Pkcs7){c=this._pta.GetCertsFromSignStr(a.toBase64(),TCA.EX.INPUT_BASE64);if(null==c||""==c)throw TCACErr.newError(1073741830,"\u9519\u8bef\u7684\u8f93\u5165\u6570\u636e");this._certs=c}else if(0!=arguments.length)throw TCACErr.newError(1073741826,"\u9519\u8bef\u7684\u8f93\u5165\u6570\u636e");this.size=function(){return this._certs.Count};this.get=function(d){return new Certificate(this._certs.Item(parseInt(d)+1).GetEncodedCert(2))};this.uiSelect=function(d){try{var a=function(){var a=
document.getElementById("msgDiv");b--;a.style.display="none";(a=document.getElementById("bgDiv"))&&0>=b&&(document.body.removeChild(a),b=0)},b=0,c="";if(null==this._pta.Version||""==this._pta.Version)return null;for(var h=1;h<=this._certs.Count;h++)this._certs.Item(h),c=c+"<table style='table-layout:fixed;'><tr style='line-height:32px;'><td style='white-space:nowrap;padding-left:10px;'><input type='radio' name='VoteOption1' value="+(h-1)+">\u4e3b\u9898\uff1a"+this._certs.Item(h).Subject+"</td></tr><tr><td style='line-height:18px;padding-left:30px;white-space:nowrap;'><li>\u9881\u53d1\u8005\uff1a"+
this._certs.Item(h).Issuer+"</li></td></tr><tr><td style='line-height:18px;padding-left:30px;white-space:nowrap;'><li>\u5e8f\u5217\u53f7\uff1a"+this._certs.Item(h).SerialNumber+"</li></td></tr></table>";var c='<div id="msgDiv" style="position:absolute;display:none;top:20%;left:35%;width:500px;height:320px;background-color:#ECECEC;z-index:2;border:6px solid #99CCFF;"><div style="height:30px;background-color:#99CCFF;line-height:30px;text-align:center;font-size:16;font-weight:bold">\u9009\u62e9\u8bc1\u4e66</div><div style="height:77%; OVERFLOW-Y: auto;background-color:#FFFFFF;border:1px solid #000000"><form name=\'form1\'>'+
c+'</form></div><div style=\'text-align:center;padding-top:10;\'><input id="submit" type="button" value="\u786e\u8ba4" style=\'width:100;\'>&nbsp;&nbsp;&nbsp;&nbsp;<input id="close" type="button" value="\u53d6\u6d88"  style=\'width:100px;\'></div></div>',f=document.getElementById("Div1");if(null==f||""==f)f=document.createElement("div1"),f.setAttribute("id","Div1"),document.body.appendChild(f),f.innerHTML=c;document.getElementById("msgDiv");document.getElementById("inpDiv");var l=document.getElementById("msgDiv"),
f=document.getElementById("bgDiv");!f&&0>=b&&(f=document.createElement("div"),f.setAttribute("id","bgDiv"),f.style.cssText="position:absolute;left:0px;top:0px;width:"+screen.availWidth+"px;height:"+screen.availHeight+"px;filter:Alpha(Opacity=30);opacity:0.6;background-color:#000000;z-index:1;",document.body.appendChild(f));b++;l.style.display="block";l.style.zIndex=101;$("#close").bind("click",function(){a();d(-1);$("#Div1").remove();$("#close").unbind()});$("#submit").bind("click",function(){var b=
document.form1.VoteOption1,c=b.length,f=null;void 0==c&&(void 0==b&&alert(null),c=1,a(),d(1),$("#submit").unbind());for(theRadioI=0;theRadioI<c;theRadioI++)if(b[theRadioI].checked){f=b[theRadioI].value;break}null!=f&&(a(),d(f),$("#Div1").remove(),$("#submit").unbind())});return!0}catch(m){throw TCACErr.newError(m.number,m.description).addError(1073741829,"\u63d0\u4ea4\u7ed3\u679c\u65f6\u51fa\u73b0\u9519\u8bef");}};this.encryptMessage=function(a){try{return certs.EncryptMessage(a,TCA.EX.OUTPUT_BASE64|
TCA.EX.PLAINTEXT_UTF8)}catch(b){throw TCACErr.newError(b.number,b.description).addError(1073741827,"\u52a0\u5bc6\u65f6\u51fa\u73b0\u9519\u8bef");}};this.forSign=function(){return this.byKeyUsage(128)};this.forEncrypt=function(){return this.byKeyUsage(32)};this.byKeyUsage=function(a){var c=0;if(a instanceof Array)for(var e=0;e<a.length;e++)"digitalSignature"==a[e]?c|=128:"nonRepudiation"==a[e]?c|=64:"keyEncipherment"==a[e]?c|=32:"dataEncipherment"==a[e]?c|=16:"keyAgreement"==a[e]?c|=8:"keyCertSign"==
a[e]?c|=4:"cRLSign"==a[e]?c|=2:"encipherOnly"==a[e]?c|=1:"decipherOnly"==a[e]?c|=32768:"contentCommitment"==a[e]&&(c|=64);else if("number"==typeof a)c=a;else throw TCACErr.newError(1073741828,"\u9519\u8bef\u7684\u8f93\u5165\u6570\u636e");a=[];for(e=1;e<=this._certs.Count;e++)if((this._certs.Item(e).KeyUsage&c)==c){var g=this._certs.Item(e).Issuer;b.test(g)&&a.push(this._certs.Item(e).GetEncodedCert(2))}return 0==a.length?new CertSet:new CertSet(a)};this.byValidity=function(a){var c;c=0==arguments.length?
new Date:new Date(a);var e=[];if(null!=c)for(var g=1;g<=this._certs.Count;g++){var h=eval(this._certs.Item(g).ValidTo),f=eval(this._certs.Item(g).ValidFrom);h>=c&&c>=f&&(h=this._certs.Item(g).Issuer,b.test(h)&&e.push(this._certs.Item(g).GetEncodedCert(2)))}return 0==e.length?new CertSet:new CertSet(e)};this.byIssuer=function(a){for(var c=[],e=1;e<=this._certs.Count;e++)if(0<=this._certs.Item(e).Issuer.search(a)){var g=this._certs.Item(e).Issuer;b.test(g)&&c.push(this._certs.Item(e).GetEncodedCert(2))}return 0==
c.length?new CertSet:new CertSet(c)};this.bySubjcet=function(a){for(var c=[],e=1;e<=this._certs.Count;e++)if(0<=this._certs.Item(e).Subject.search(a)){var g=this._certs.Item(e).Issuer;b.test(g)&&c.push(this._certs.Item(e).GetEncodedCert(2))}return 0==c.length?new CertSet:new CertSet(c)};this.bySerialnumber=function(a){for(var b=1;b<=this._certs.Count;b++)if(this._certs.Item(b).SerialNumber===a.toLowerCase())return new CertSet(this._certs.Item(b).GetEncodedCert(2));return new CertSet}}
function SecretKey(a,c,b){this._key=c;this._Alg=a;this._IV=b;this.getKey=function(){return this._key};this.getIV=function(){return this._IV};this.getAlg=function(){return this._Alg};this.encryptFile2Msg=function(a){var b=CPlugin.getInstance().getPTA(),c=TCA.EX.PARAM_FILENAME,g=TCA.EX.PARAM_STRING|TCA.EX.OUTPUT_BASE64,h=TCA.EX.AlgID,f=null;try{f=b.SymmEnc(a,c,"",g,h,this._key,this._IV)}catch(l){switch((l.number>>>0).toString(16)){case "80082001":throw TCACErr.newError(l.number,l.description).addError(2148016129,
"\u8bfb\u53d6\u6587\u4ef6\u9519\u8bef");case "80082002":throw TCACErr.newError(l.number,l.description).addError(2148016130,"\u53c2\u6570\u8bbe\u7f6e\u9519\u8bef");case "80081001":throw TCACErr.newError(l.number,l.description).addError(2148012033,"Key\u6216IV\u957f\u5ea6\u4e0d\u9002\u7528\u4e8e\u9009\u62e9\u7684\u7b97\u6cd5");case "80083001":throw TCACErr.newError(l.number,l.description).addError(2148020225,"\u5199\u5165\u6587\u4ef6\u5931\u8d25");default:throw TCACErr.newError(l.number,l.description).addError(2148016674,
"\u672a\u77e5\u9519\u8bef");}}return f};this.decryptMsg2File=function(a,b,c){c=CPlugin.getInstance().getPTA();var g=TCA.EX.PARAM_STRING|TCA.EX.INPUT_BASE64,h=TCA.EX.PARAM_FILENAME,f=TCA.EX.AlgID;try{c.SymmDec(a,g,b,h,f,this._key,this._IV)}catch(l){switch(l.number.toString(16)){case "80082001":throw TCACErr.newError(l.number,l.description).addError(2148016129,"\u8bfb\u53d6\u6587\u4ef6\u9519\u8bef");case "80082002":throw TCACErr.newError(l.number,l.description).addError(2148016130,"\u53c2\u6570\u8bbe\u7f6e\u9519\u8bef");
case "80081001":throw TCACErr.newError(l.number,l.description).addError(2148012033,"Key\u6216IV\u957f\u5ea6\u4e0d\u9002\u7528\u4e8e\u9009\u62e9\u7684\u7b97\u6cd5");case "80083001":throw TCACErr.newError(l.number,l.description).addError(2148020225,"\u5199\u5165\u6587\u4ef6\u5931\u8d25");default:throw TCACErr.newError(l.number,l.description).addError(2148012305,"\u672a\u77e5\u9519\u8bef");}}return!0}}
SecretKey.genKey=function(a){switch(a){case "SM4":break;default:throw TCACErr.newError(2148042888,"\u4e0d\u652f\u6301\u8be5\u7b97\u6cd5");}var c;c=16;for(var b="",d=0;d<c;d++)var k=Math.floor(255*Math.random()),b=k<c?b+("0"+k.toString(16)):b+k.toString(16);c=b;return new SecretKey(a,c,c)};
var CPlugin=function(){function a(a){e._config={};e._config.certkitClsID=void 0!==a.certkitClsID?a.certkitClsID:"640908F9-0369-487a-998D-7B12B7A5EB06";e._config.certkitPrgID=void 0!==a.certkitPrgID?a.certkitPrgID:"TopCertKitgs.CertKit.Version.1";e._config.certkitVer=void 0!==a.certkitVer?a.certKitVer:"0,0,0,1001";e._config.ptaVer=void 0!==a.ptaVer?a.ptaVer:"0,0,0,1102";e._config.xenrollVer=void 0!==a.xenrollVer?a.xenrollVer:"0,0,0,301";e._config.lic=void 0!==a.lic?a.lic:null;e._config.useAlias=void 0!==
a.useAlias?a.useAlias:!0;e._config.disableExeUrl=void 0!==a.disableExeUrl?a.disableExeUrl:!1;e._config.cspAlias=void 0!==a.cspAlias?a.cspAlias:{"RSA\u8f6f\u8bc1\u4e66":"Microsoft Enhanced Cryptographic Provider v1.0","\u98de\u5929 ePass 3000 GM":"EnterSafe ePass3000GM CSP v1.0","\u534e\u5927\u667a\u5b9d SJK102":"CIDC Cryptographic Service Provider v3.0.0","SM2\u8f6f\u8bc1\u4e66":"iTrusChina Cryptographic Service Provider v1.0.0","\u795e\u5dde\u9f99\u82af":"ChinaCpu USB Key CSP v1.0"};e._config.whiteList=
void 0!==a.whiteList?a.whiteList:["Microsoft Enhanced Cryptographic Provider v1.0","iTrusChina Cryptographic Service Provider v1.0.0"];e._config.lic=void 0!==a.license?a.license:null;e._config.licinfo=null;e._config.alertOnSignMessage=void 0!==a.alertOnSignMessage?a.alertOnSignMessage:!0;var b=window.location.toString().split("/"),b=b[0]+"//"+window.location.host+"/"+b[3];e._config.cabpath=void 0===a.cabpath?b+"/download/itruscertctl.cab":a.cabpath;e._config.exepath=void 0===a.exepath?b+"/download/tianwei.rar":
a.exepath;e._config.licver="1.1.1.1";e._config.otherio=1;e._config.licenseio=1}function c(){if(null==e._config.lic)throw TCACErr.newError(4278190335,"\u672a\u53d1\u73b0\u6709\u6548License!");var a=e._pta.checkLic(e._config.lic,"",0);if(null==a||""==a)throw TCACErr.newError(4278190591,"\u9a8c\u8bc1License\u5931\u8d25");e._config.licinfo=eval("("+a+")");if(e._config.licinfo.version!=e._config.licver)throw TCACErr.newError(4278191103,"\u672a\u4f7f\u7528\u6709\u6548License");var a=new Date,b=e._config.licinfo.notbefore.split("-"),
c=e._config.licinfo.notafter.split("-");if(new Date(c[0],c[1]-1,c[2])<a||new Date(b[0],b[1]-1,b[2])>a)throw TCACErr.newError(4278191615,"\u672a\u4f7f\u7528\u6709\u6548License");}function b(){0==e._config.disableExeUrl&&(window.location.href=e._config.exepath)}function d(a,b,c){var d=null,d=c.split(",");c=(parseInt(d[0])<<24)+(parseInt(d[1])<<16)+(parseInt(d[2])<<8)+parseInt(d[3]);d=b?a.Version():a.Version;if(d==c||233==d||78==d||45==d)return 0;if(d<c)return-1;if(d>c)return 1}var k=null,e={_pta:null,
_certkit:null,_xenroll:null,_config:null};a({});var g=function(){this.getPTA=function(){if(null==e._pta||void 0==e._pta)throw TCACErr.newError(4278192383,"\u672a\u80fd\u52a0\u8f7d\u5ba2\u6237\u7aef\u7ec4\u4ef6");return e._pta};this.getXEnroll=function(){if(null==e._xenroll||void 0==e._xenroll)throw TCACErr.newError(4278192639,"\u672a\u80fd\u52a0\u8f7d\u5ba2\u6237\u7aef\u7ec4\u4ef6");return e._xenroll};this.getCertKit=function(){if(null==e._certkit||void 0==e._certkit)throw TCACErr.newError(4278192895,
"\u672a\u80fd\u52a0\u8f7d\u5ba2\u6237\u7aef\u7ec4\u4ef6");return e._certkit};this.full2Alias=function(a){for(var b in e._config.cspAlias)if(e._config.cspAlias[b]==a)return b;return a};this.alias2Full=function(a){var b=e._config.cspAlias[a];return void 0===b?a:b};this.convertCert=function(a){var b=h().getPTA().Filter;if(a instanceof Certificate)b.SerialNumber=a.serialNumber();else try{b.SerialNumber=a.SerialNumber}catch(c){return null}a=h().getPTA().MyCertificates;b=h().getPTA().OtherCertificates;
return 0!=a.Count?a.Item(1):0!=b.Count?b.Item(1):null};this.getConfig=function(a){return e._config[a]};this.getLicInfo=function(a){if(null==e._config.licinfo)throw TCACErr.newError(4278190847,"\u672a\u8bbe\u7f6e\u6709\u6548License!");return e._config.licinfo[a]}},h=function(f){void 0!==f&&a(f);if(!k){var h,m,q;f=navigator.userAgent;if(0<f.indexOf("MSIE")||-1<f.toLocaleLowerCase().indexOf("trident"))try{var n="<object id='CertKit' classid='clsid:"+e._config.certkitClsID+"' ",n=n+"></object>",p=document.getElementById("CertKitDiv");
if(null==p||""==p)p=document.createElement("div"),p.setAttribute("id","CertKitDiv"),document.body.appendChild(p),p.innerHTML=n;h=document.getElementById("CertKit")}catch(r){h=null}else try{m="<embed id='CertKit' type='application/"+e._config.certkitPrgID+"' width='0' height='0'></embed>";q=navigator.plugins.length;n=null;for(p=0;p<q;p++)if(-1<navigator.plugins[p].name.indexOf("TopCertKit")){n=$(m).appendTo(document.body)[0];break}h=n}catch(s){h=null}if(null==h||void 0==d(h,!1,e._config.certkitVer))throw b(),
TCACErr.newError(4278192127,"\u672a\u80fd\u52a0\u8f7d\u5ba2\u6237\u7aef\u7ec4\u4ef6");m=h.GetPTA();q=h.GetXEnroll();0==d(m,!1,e._config.ptaVer)&&0==d(q,!0,e._config.xenrollVer)||b();e._certkit=h;e._pta=m;e._xenroll=q;c();k=new g}return k};return{getInstance:h}}();
function TCACErr(){this._errarr=[];this.addError=function(a,c){this.number=a;this.description=c;this._errarr.push({code:a.toString(16),msg:c});return this};this.toStr=function(){for(var a="",c=0;c<this._errarr.length;c++)a+=this._errarr[c].msg+"   \u9519\u8bef\u7801\uff1a0x"+this._errarr[c].code+", ";return a.substr(0,a.length-2)}}TCACErr.prototype=Error();TCACErr.newError=function(a,c){return(new TCACErr).addError(a,c)};
var Base64={decode:function(a){try{var c;if(void 0===Base64.decoder){var b=[];for(c=0;64>c;++c)b["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(c)]=c;for(c=0;9>c;++c)b["= \f\n\r\t\u00a0\u2028\u2029".charAt(c)]=-1;Base64.decoder=b}var b=[],d=0,k=0;for(c=0;c<a.length;++c){var e=a.charAt(c);if("="==e)break;e=Base64.decoder[e];if(-1!=e){if(void 0===e)throw"Illegal character at offset "+c;d|=e;4<=++k?(b[b.length]=d>>16,b[b.length]=d>>8&255,b[b.length]=d&255,k=d=0):d<<=6}}switch(k){case 1:throw"Base64 encoding incomplete: at least 2 bits missing";
case 2:b[b.length]=d>>10;break;case 3:b[b.length]=d>>16,b[b.length]=d>>8&255}return b}catch(g){alert(g)}},re:/-----BEGIN [^-]+-----([A-Za-z0-9+\/=\s]+)-----END [^-]+-----|begin-base64[^\n]+\n([A-Za-z0-9+\/=\s]+)====/,unarmor:function(a){try{var c=Base64.re.exec(a);if(c)if(c[1])a=c[1];else if(c[2])a=c[2];else throw"RegExp out of sync";return Base64.decode(a)}catch(b){alert(b)}}};function Stream(a,c){try{a instanceof Stream?(this.enc=a.enc,this.pos=a.pos):(this.enc=a,this.pos=c)}catch(b){}}
Stream.prototype.ellipsis="\u2026";Stream.prototype.get=function(a){try{return void 0===a&&(a=this.pos++),this.enc[a]}catch(c){alert(c)}};Stream.prototype.hexDigits="0123456789ABCDEF";Stream.prototype.hexByte=function(a){return this.hexDigits.charAt(a>>4&15)+this.hexDigits.charAt(a&15)};Stream.prototype.hexDump=function(a,c,b){try{for(var d="";a<c;++a)if(d+=this.hexByte(this.get(a)),!0!==b)switch(a&15){case 7:d+="  ";break;case 15:d+="\n";break;default:d+=" "}return d}catch(k){}};
Stream.prototype.parseStringISO=function(a,c){try{for(var b="",d=a;d<c;++d)b+=String.fromCharCode(this.get(d));return b}catch(k){}};Stream.prototype.parseStringUTF=function(a,c){try{for(var b="",d=0,k=a;k<c;)d=this.get(k++),b=128>d?b+String.fromCharCode(d):191<d&&224>d?b+String.fromCharCode((d&31)<<6|this.get(k++)&63):b+String.fromCharCode((d&15)<<12|(this.get(k++)&63)<<6|this.get(k++)&63);return b}catch(e){}};Stream.prototype.reTime=/^((?:1[89]|2\d)?\d\d)(0[1-9]|1[0-2])(0[1-9]|[12]\d|3[01])([01]\d|2[0-3])(?:([0-5]\d)(?:([0-5]\d)(?:[.,](\d{1,3}))?)?)?(Z|[-+](?:[0]\d|1[0-2])([0-5]\d)?)?$/;
Stream.prototype.parseTime=function(a,c){try{return this.parseStringISO(a,c)}catch(b){}};Stream.prototype.parseInteger=function(a,c){try{for(var b=0,d=a;d<c;++d)b=b<<8|this.get(d);return b}catch(k){}};Stream.prototype.parseBitString=function(a,c){try{var b=this.get(a),d="";if(20>=(c-a-1<<3)-b)for(var k=c-1;k>a;--k){for(var e=this.get(k),g=b;8>g;++g)d+=e>>g&1?"1":"0";b=0}return d}catch(h){}};Stream.prototype.parseOctetString=function(a,c){try{for(var b="",d=a;d<c;++d)b+=this.hexByte(this.get(d));return b}catch(k){}};
Stream.prototype.parseOID=function(a,c){try{for(var b="",d=0,k=0,e=a;e<c;++e){var g=this.get(e),d=d<<7|g&127,k=k+7;if(!(g&128)){if(""===b)var h=80>d?40>d?0:1:2,b=h+"."+(d-40*h);else b+="."+(31<=k?"bigint":d);d=k=0}}return b}catch(f){}};function ASN1(a,c,b,d,k){try{this.stream=a,this.header=c,this.length=b,this.tag=d,this.sub=k}catch(e){}}
ASN1.prototype.typeName=function(){try{if(void 0===this.tag)return"unknown";var a=this.tag&31;switch(this.tag>>6){case 0:switch(a){case 0:return"EOC";case 1:return"BOOLEAN";case 2:return"INTEGER";case 3:return"BIT_STRING";case 4:return"OCTET_STRING";case 5:return"NULL";case 6:return"OBJECT_IDENTIFIER";case 7:return"ObjectDescriptor";case 8:return"EXTERNAL";case 9:return"REAL";case 10:return"ENUMERATED";case 11:return"EMBEDDED_PDV";case 12:return"UTF8String";case 16:return"SEQUENCE";case 17:return"SET";
case 18:return"NumericString";case 19:return"PrintableString";case 20:return"TeletexString";case 21:return"VideotexString";case 22:return"IA5String";case 23:return"UTCTime";case 24:return"GeneralizedTime";case 25:return"GraphicString";case 26:return"VisibleString";case 27:return"GeneralString";case 28:return"UniversalString";case 30:return"BMPString";default:return"Universal_"+a.toString(16)}case 1:return"Application_"+a.toString(16);case 2:return"["+a+"]";case 3:return"Private_"+a.toString(16)}}catch(c){}};
ASN1.prototype.reSeemsASCII=/^[ -~]+$/;
ASN1.prototype.content=function(){try{if(void 0===this.tag)return null;var a=this.tag>>6,c=this.tag&31,b=this.posContent(),d=Math.abs(this.length);if(0!==a){if(null!==this.sub)return"("+this.sub.length+" elem)";var k=this.stream.parseStringISO(b,b+d);return this.reSeemsASCII.test(k)?k.substring(0,d):this.stream.parseOctetString(b,b+d)}switch(c){case 1:return 0===this.stream.get(b)?"false":"true";case 2:return this.stream.parseInteger(b,b+d);case 3:return this.sub?"("+this.sub.length+" elem)":this.stream.parseBitString(b,
b+d);case 4:return this.sub?"("+this.sub.length+" elem)":this.stream.parseOctetString(b,b+d);case 6:return this.stream.parseOID(b,b+d);case 16:case 17:return"("+this.sub.length+" elem)";case 12:return this.stream.parseStringUTF(b,b+d);case 18:case 19:case 20:case 21:case 22:case 26:return this.stream.parseStringISO(b,b+d);case 23:case 24:return this.stream.parseTime(b,b+d)}return null}catch(e){}};
ASN1.prototype.toString=function(){return this.typeName()+"@"+this.stream.pos+"[header:"+this.header+",length:"+this.length+",sub:"+(null===this.sub?"null":this.sub.length)+"]"};ASN1.prototype.print=function(a){try{if(void 0===a&&(a=""),document.writeln(a+this),null!==this.sub){a+="  ";for(var c=0,b=this.sub.length;c<b;++c)this.sub[c].print(a)}}catch(d){}};
ASN1.prototype.toPrettyString=function(a){try{void 0===a&&(a="");var c=a+this.typeName()+" @"+this.stream.pos;0<=this.length&&(c+="+");c+=this.length;this.tag&32?c+=" (constructed)":3!=this.tag&&4!=this.tag||null===this.sub||(c+=" (encapsulates)");c+="\n";if(null!==this.sub){a+="  ";for(var b=0,d=this.sub.length;b<d;++b)c+=this.sub[b].toPrettyString(a)}return c}catch(k){}};ASN1.prototype.posStart=function(){return this.stream.pos};ASN1.prototype.posContent=function(){return this.stream.pos+this.header};
ASN1.prototype.posEnd=function(){return this.stream.pos+this.header+Math.abs(this.length)};ASN1.prototype.toHexString=function(a){return this.stream.hexDump(this.posStart(),this.posEnd(),!0)};ASN1.decodeLength=function(a){try{var c=a.get(),b=c&127;if(b==c)return b;if(0===b)return null;for(var d=c=0;d<b;++d)c=256*c+a.get();return c}catch(k){alert(k)}};
ASN1.hasContent=function(a,c,b){if(a&32)return!0;if(3>a||4<a)return!1;var d=new Stream(b);3==a&&d.get();if(d.get()>>6&1)return!1;try{var k=ASN1.decodeLength(d);return d.pos-b.pos+k==c}catch(e){return!1}};
ASN1.decode=function(a){try{a instanceof Stream||(a=new Stream(a,0));var c=new Stream(a),b=a.get(),d=ASN1.decodeLength(a),k=a.pos-c.pos,e=null;if(ASN1.hasContent(b,d,a)){var g=a.pos;3==b&&a.get();e=[];if(0<=d)for(g+=d;a.pos<g;)e[e.length]=ASN1.decode(a);else try{for(;;){var h=ASN1.decode(a);if(0===h.tag)break;e[e.length]=h}d=g-a.pos}catch(f){throw"Exception while decoding undefined length content: "+f;}}else a.pos+=d;return new ASN1(c,k,d,b,e)}catch(l){alert(l)}};
